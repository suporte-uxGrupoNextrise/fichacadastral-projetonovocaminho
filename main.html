<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Projeto Novo Caminho</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* Fundo verde muito claro */
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        /* NOVA PALETA DE CORES: Verde "Novo Caminho" */
        .primary-bg { background-color: #0f766e; } /* Teal 700 */
        .primary-text { color: #0f766e; }
        
        /* Cor de destaque: Laranja/Amber */
        .accent-bg { background-color: #f59e0b; }
        .accent-text { color: #f59e0b; }
        .accent-border { border-color: #f59e0b; }

        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }

        .form-input {
            border: 1px solid #cbd5e1;
            transition: all 0.3s;
        }
        .form-input:focus {
            border-color: #f59e0b;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
            outline: none;
        }
        /* Estilo para o switch toggle */
        .toggle-checkbox:checked {
            background-color: #0f766e;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #0f766e;
        }
        .form-input[disabled], .form-input[readonly] {
            background-color: #f1f5f9;
            color: #64748b;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #0f766e;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #115e59;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #475569;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        /* Estilo para spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0f766e;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        .loader-sm {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0f766e;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6 md:p-8">
        <div class="text-center mb-6">
            <div class="mx-auto h-20 w-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 text-2xl font-bold text-gray-400">
                LOGO
            </div>
            <h1 class="text-2xl md:text-3xl font-bold primary-text">Ficha Cadastral</h1>
            <p class="text-gray-600 mt-2 font-medium">PROJETO NOVO CAMINHO</p>
        </div>

        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
            <div id="progressBar" class="accent-bg h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
        </div>
        <p id="progressMessage" class="text-center text-sm text-gray-500 mb-6 italic"></p>


        <form id="regForm" novalidate>
            <div class="form-step active">
                <h2 class="text-xl font-semibold text-center primary-text mb-4">Bem-vindo(a) à Família!</h2>
                <p class="text-center text-gray-700 mb-8">
                    Estamos felizes em ter você conosco no <strong>Projeto Novo Caminho</strong>.<br>
                    Por favor, preencha seus dados para mantermos nosso cadastro atualizado.
                </p>
                <div class="text-center text-sm text-gray-500">Clique em "Iniciar" para começar.</div>
            </div>

            <div class="form-step">
                <h2 class="text-xl font-semibold primary-text mb-4">1. Dados Pessoais</h2>
                <div class="grid grid-cols-1 gap-4">
                    <input type="text" placeholder="Nome Completo" name="nomeCompleto" class="w-full p-3 rounded-lg form-input" required>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <select name="sexo" class="w-full p-3 rounded-lg form-input bg-white" required>
                            <option value="" disabled selected>Sexo</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                        </select>
                        <input type="text" placeholder="Data Nasc. (DD/MM/AAAA)" name="dataNascimento" class="w-full p-3 rounded-lg form-input" required oninput="maskDate(this)">
                    </div>

                    <input type="text" placeholder="Naturalidade (Cidade/Estado)" name="naturalidade" class="w-full p-3 rounded-lg form-input">
                    <input type="text" placeholder="Profissão / Ocupação" name="profissao" class="w-full p-3 rounded-lg form-input">
                    
                    <input type="text" placeholder="Nome da Mãe" name="nomeMae" class="w-full p-3 rounded-lg form-input" required>
                    <input type="text" placeholder="Nome do Pai (Opcional)" name="nomePai" class="w-full p-3 rounded-lg form-input">
                </div>
            </div>

            <div class="form-step">
                <h2 class="text-xl font-semibold primary-text mb-4">2. Dados de Adesão</h2>
                <div class="grid grid-cols-1 gap-4">
                    <label class="text-sm font-medium text-gray-600">Qual sua situação atual no projeto?</label>
                    <select name="situacaoMembro" class="w-full p-3 rounded-lg form-input bg-white" required>
                        <option value="" disabled selected>Selecione a Situação</option>
                        <option value="MEMBRO">Membro (Batizado)</option>
                        <option value="CONGREGADO">Congregado (Não Batizado)</option>
                        <option value="VISITANTE">Visitante</option>
                        <option value="OBREIRO">Obreiro / Staff</option>
                    </select>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-medium text-gray-600">Data de Entrada no Projeto</label>
                            <input type="text" placeholder="DD/MM/AAAA" name="dataEntrada" class="w-full p-3 rounded-lg form-input" oninput="maskDate(this)">
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600">Data de Batismo (Se houver)</label>
                            <input type="text" placeholder="DD/MM/AAAA" name="dataBatismo" class="w-full p-3 rounded-lg form-input" oninput="maskDate(this)">
                        </div>
                    </div>

                    <select name="igrejaOrigem" class="w-full p-3 rounded-lg form-input bg-white">
                        <option value="" disabled selected>Veio de outra denominação?</option>
                        <option value="NAO">Não, primeira igreja</option>
                        <option value="SIM">Sim (Especifique abaixo)</option>
                    </select>
                    <input type="text" placeholder="Qual igreja/projeto anterior?" name="nomeIgrejaAnterior" class="w-full p-3 rounded-lg form-input">
                </div>
            </div>
            
            <div class="form-step">
                <h2 class="text-xl font-semibold primary-text mb-4">3. Documentos e Contato</h2>
                
                <div class="flex items-center justify-end mb-4">
                    <label for="internationalToggle" class="mr-3 text-sm font-medium text-gray-900">Mora no Exterior?</label>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="isInternational" id="internationalToggle" value="true" onchange="toggleInternationalMode()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="internationalToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>

                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="documentosNacionais" class="contents">
                        <input type="text" placeholder="CPF" name="cpf" id="cpf" class="p-3 rounded-lg form-input" required oninput="maskCPF(this)">
                        <input type="text" placeholder="RG" name="rg" id="rg" class="p-3 rounded-lg form-input" required>
                    </div>
                    <div id="documentoInternacionalWrapper" class="hidden md:col-span-2">
                        <input type="text" placeholder="Nº Documento (Passaporte, ID)" name="documentoInternacional" id="documentoInternacional" class="p-3 rounded-lg form-input w-full">
                    </div>

                    <div class="flex items-center md:col-span-2 gap-2">
                        <select id="countryCode" name="countryCode" onchange="updatePhoneMask()" class="w-1/3 p-3 rounded-lg form-input bg-white">
                            <option value="+55" selected>Brasil (+55)</option>
                            <option value="+351">Portugal (+351)</option>
                            <option value="+1">EUA (+1)</option>
                            <option value="Outro">Outro</option>
                        </select>
                        <input type="tel" placeholder="Celular (WhatsApp)" name="celular" id="celular" class="w-2/3 p-3 rounded-lg form-input" required oninput="applyCurrentMask(this)">
                    </div>
                    <input type="email" placeholder="E-mail Pessoal" name="email" class="p-3 rounded-lg form-input md:col-span-2">
                </div>
            </div>

            <div class="form-step">
                <h2 class="text-xl font-semibold primary-text mb-4">4. Endereço Residencial</h2>
                <div class="grid grid-cols-1 gap-4">
                    <div id="enderecoNacional">
                        <input type="text" placeholder="Digite o CEP" name="cep" id="cep" class="p-3 rounded-lg form-input" oninput="maskCEP(this)" onblur="buscarCEP()">
                        <div id="cep-loader" class="hidden flex items-center gap-2 text-gray-600 mt-2"><div class="loader-sm"></div> Buscando endereço...</div>
                    </div>
                    
                    <input type="text" placeholder="Rua / Avenida" name="rua" id="rua" class="p-3 rounded-lg form-input bg-gray-100" readonly>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" placeholder="Número" name="numero" id="numero" class="p-3 rounded-lg form-input">
                        <input type="text" placeholder="Complemento" name="complemento" id="complemento" class="p-3 rounded-lg form-input">
                    </div>
                    <input type="text" placeholder="Bairro" name="bairro" id="bairro" class="p-3 rounded-lg form-input bg-gray-100" readonly>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" placeholder="Cidade" name="cidade" id="cidade" class="p-3 rounded-lg form-input bg-gray-100" readonly>
                        <input type="text" placeholder="Estado (UF)" name="uf" id="uf" class="p-3 rounded-lg form-input bg-gray-100" readonly>
                    </div>
                    <input type="text" placeholder="País" name="pais" id="pais" value="Brasil" class="p-3 rounded-lg form-input bg-gray-100" readonly>
                </div>
            </div>
            
            <div class="form-step">
                 <h2 class="text-xl font-semibold primary-text mb-4">5. Família e Saúde</h2>
                 <div class="space-y-4">
                    <select name="estadoCivil" id="estadoCivil" class="w-full p-3 rounded-lg form-input bg-white" onchange="toggleConjugeFields()">
                        <option value="" disabled selected>Estado Civil</option>
                        <option value="Solteiro(a)">Solteiro(a)</option>
                        <option value="Casado(a)">Casado(a)</option>
                        <option value="Divorciado(a)">Divorciado(a)</option>
                        <option value="Viúvo(a)">Viúvo(a)</option>
                    </select>
                    
                    <div id="conjugeFields" class="hidden space-y-4 border p-4 rounded-lg bg-gray-50">
                         <h3 class="font-medium text-gray-700">Dados do Cônjuge</h3>
                         <input type="text" placeholder="Nome do Cônjuge" name="nomeConjuge" class="w-full p-3 rounded-lg form-input">
                    </div>

                    <select name="escolaridade" class="w-full p-3 rounded-lg form-input bg-white">
                        <option value="" disabled selected>Escolaridade</option>
                        <option value="Fundamental">Fundamental</option>
                        <option value="Medio">Ensino Médio</option>
                        <option value="Superior">Ensino Superior</option>
                    </select>
                    
                    <textarea name="problemasSaude" placeholder="Possui alguma alergia ou problema de saúde? (Opcional)" rows="2" class="w-full p-3 rounded-lg form-input"></textarea>
                 </div>
            </div>

            <div class="form-step">
                <h2 class="text-xl font-semibold primary-text mb-4">6. Foto e Finalização</h2>
                <div class="space-y-4">
                    <div class="text-center p-6 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50">
                        <label class="block mb-2 font-medium text-gray-700">Sua Foto de Perfil</label>
                        <p class="text-sm text-gray-500 mb-4">Tire uma selfie agora ou envie uma foto do seu arquivo.</p>
                        
                        <input type="file" name="foto" id="fotoInput" accept="image/*" capture="user" class="hidden" required>
                        
                        <label for="fotoInput" class="cursor-pointer inline-flex items-center justify-center py-3 px-8 rounded-full font-semibold btn-primary shadow-lg transform transition hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            Tirar / Escolher Foto
                        </label>
                        
                        <div class="mt-4">
                            <span id="fileName" class="text-sm text-gray-600 block mb-2">Nenhum arquivo selecionado.</span>
                            <img id="preview" src="" alt="Prévia" class="hidden rounded-full h-32 w-32 object-cover mx-auto border-4 border-gray-200 shadow-md"/>
                        </div>
                    </div>
                    
                    <textarea name="observacoes" placeholder="Observações Gerais / Pedido de Oração (Opcional)" rows="3" class="w-full p-3 rounded-lg form-input"></textarea>
                </div>
            </div>

            <div class="mt-8 flex justify-between items-center">
                <button type="button" id="prevBtn" onclick="nextPrev(-1)" class="py-2 px-6 rounded-lg font-semibold btn-secondary" style="display:none;">Voltar</button>
                <button type="button" id="nextBtn" onclick="nextPrev(1)" class="py-2 px-6 rounded-lg font-semibold btn-primary">Iniciar</button>
                <div id="loader" class="hidden loader"></div>
            </div>
            
             <div id="message" class="hidden mt-6 text-center p-4 rounded-lg"></div>
        </form>
    </div>

<script>
    let currentStep = 0;
    const steps = document.getElementsByClassName("form-step");
    const progressBar = document.getElementById("progressBar");
    const progressMessage = document.getElementById("progressMessage");
    
    // ATENÇÃO: SUBSTITUA ESTA URL PELA SUA NOVA URL DO GOOGLE APPS SCRIPT
    const SCRIPT_URL = 'URL_DO_SEU_GOOGLE_SCRIPT_AQUI'; 
    
    // Máscaras Padrão
    let currentPhoneMask = (el) => mask(el, '(##) #####-####');

    document.addEventListener("DOMContentLoaded", function() {
        showStep(currentStep);
    });

    function showStep(n) {
        for (let i = 0; i < steps.length; i++) {
            steps[i].classList.remove("active");
        }
        steps[n].classList.add("active");

        document.getElementById("prevBtn").style.display = n === 0 ? "none" : "inline";
        
        const nextBtn = document.getElementById("nextBtn");
        if (n === (steps.length - 1)) {
            nextBtn.innerHTML = "Finalizar Cadastro";
        } else if (n === 0) {
            nextBtn.innerHTML = "Iniciar";
        } else {
            nextBtn.innerHTML = "Próximo >";
        }

        updateProgressBar(n);
    }

    function updateProgressBar(n) {
        const totalSteps = steps.length - 1; 
        let progress = n > 0 ? (n / totalSteps) * 100 : 0;
        progressBar.style.width = progress + "%";
        
        switch(n) {
            case 0: progressMessage.textContent = ""; break;
            case 1: progressMessage.textContent = "Vamos começar pelos seus dados básicos."; break;
            case 2: progressMessage.textContent = "Entendendo sua caminhada no projeto."; break;
            case 3: progressMessage.textContent = "Documentação para nosso sistema."; break;
            case 4: progressMessage.textContent = "Onde você mora?"; break;
            case 5: progressMessage.textContent = "Dados complementares importantes."; break;
            case 6: progressMessage.textContent = "Sorria para a foto!"; break;
            default: progressMessage.textContent = "";
        }
    }

    function nextPrev(n) {
        if (n === 1 && !validateForm()) return false;
        if (currentStep >= steps.length - 1 && n === 1) {
            submitForm();
            return false;
        }
        currentStep += n;
        showStep(currentStep);
    }
    
    function validateForm() {
        let valid = true;
        const currentInputs = steps[currentStep].querySelectorAll("input[required], select[required]");
        currentInputs.forEach(input => {
            input.classList.remove('border-red-500');
            if (input.offsetParent !== null && !input.value) {
                input.classList.add('border-red-500');
                valid = false;
            }
        });
        return valid;
    }
    
    // Máscaras
    const mask = (element, mask) => {
        const unmasked = element.value.replace(/\D/g, '');
        let masked = '';
        let k = 0;
        for (let i = 0; i < mask.length; i++) {
            if (mask[i] === '#') {
                if (unmasked[k]) masked += unmasked[k++];
            } else {
                if (unmasked[k]) masked += mask[i];
            }
        }
        element.value = masked;
    };
    const maskDate = (el) => mask(el, '##/##/####');
    const maskCPF = (el) => mask(el, '###.###.###-##');
    const maskCEP = (el) => mask(el, '#####-###');

    function updatePhoneMask() {
        const countryCode = document.getElementById('countryCode').value;
        const celularInput = document.getElementById('celular');
        if (countryCode === '+55') {
            currentPhoneMask = (el) => mask(el, '(##) #####-####');
            celularInput.placeholder = "(WhatsApp)";
        } else {
            currentPhoneMask = (el) => {}; 
            celularInput.placeholder = "Número de Celular";
        }
        celularInput.value = '';
    }
    function applyCurrentMask(el) { currentPhoneMask(el); }

    function toggleInternationalMode() {
        const isInternational = document.getElementById('internationalToggle').checked;
        const docNacional = document.getElementById('documentosNacionais');
        const docInterWrapper = document.getElementById('documentoInternacionalWrapper');
        const cepWrapper = document.getElementById('enderecoNacional');
        const addressFields = ['rua', 'bairro', 'cidade', 'uf', 'pais'];

        if (isInternational) {
            docNacional.classList.add('hidden');
            docInterWrapper.classList.remove('hidden');
            document.getElementById('cpf').required = false;
            document.getElementById('rg').required = false;
            document.getElementById('documentoInternacional').required = true;
            
            cepWrapper.classList.add('hidden');
            document.getElementById('cep').required = false;
            addressFields.forEach(id => {
                const el = document.getElementById(id);
                el.readOnly = false;
                el.classList.remove('bg-gray-100');
                el.classList.add('bg-white');
                if(id === 'pais') el.value = '';
            });
        } else {
            docNacional.classList.remove('hidden');
            docInterWrapper.classList.add('hidden');
            document.getElementById('cpf').required = true;
            document.getElementById('rg').required = true;
            document.getElementById('documentoInternacional').required = false;

            cepWrapper.classList.remove('hidden');
            document.getElementById('cep').required = true;
            addressFields.forEach(id => {
                const el = document.getElementById(id);
                el.readOnly = true;
                el.classList.add('bg-gray-100');
                el.value = (id === 'pais') ? 'Brasil' : '';
            });
        }
    }

    async function buscarCEP() {
        const isInternational = document.getElementById('internationalToggle').checked;
        if (isInternational) return;

        const cepInput = document.getElementById('cep');
        const cep = cepInput.value.replace(/\D/g, '');
        const loader = document.getElementById('cep-loader');
        
        if (cep.length !== 8) return;

        loader.classList.remove('hidden');
        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const data = await response.json();

            if (data.erro) {
                alert("CEP não encontrado.");
                return;
            }
            document.getElementById('rua').value = data.logradouro;
            document.getElementById('bairro').value = data.bairro;
            document.getElementById('cidade').value = data.localidade;
            document.getElementById('uf').value = data.uf;
            document.getElementById('pais').value = "Brasil";
        } catch (error) {
            console.error(error);
        } finally {
            loader.classList.add('hidden');
        }
    }

    function toggleConjugeFields() {
        const estadoCivil = document.getElementById('estadoCivil').value;
        const conjugeFields = document.getElementById('conjugeFields');
        conjugeFields.style.display = estadoCivil === 'Casado(a)' ? 'block' : 'none';
    }

    const fotoInput = document.getElementById('fotoInput');
    const preview = document.getElementById('preview');
    const fileNameSpan = document.getElementById('fileName');

    fotoInput.onchange = evt => {
        const [file] = fotoInput.files
        if (file) {
            preview.src = URL.createObjectURL(file);
            preview.classList.remove('hidden');
            fileNameSpan.textContent = "Foto selecionada!";
        }
    }

    function submitForm() {
        if (SCRIPT_URL.includes("URL_DO_SEU")) {
            alert('Configure a URL do Script no código (Linha ~240).');
            return;
        }

        const form = document.getElementById('regForm');
        const fileInput = document.getElementById('fotoInput');
        const file = fileInput.files[0];
        const loader = document.getElementById('loader');
        const messageDiv = document.getElementById('message');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');

        if (!file) {
            alert('A foto é obrigatória.');
            return;
        }

        loader.classList.remove('hidden');
        nextBtn.classList.add('hidden');
        prevBtn.classList.add('hidden');
        messageDiv.classList.add('hidden');

        const fr = new FileReader();
        fr.readAsDataURL(file);

        fr.onload = (f) => {
            const fileData = {
                base64: f.target.result.split(",")[1],
                type: file.type,
                name: file.name
            }
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);
            data.isInternational = document.getElementById('internationalToggle').checked;

            const finalPayload = { ...data, foto: fileData };
            
            fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(finalPayload)
            })
            .then(res => res.json())
            .then(data => {
                loader.classList.add('hidden');
                messageDiv.classList.remove('hidden');
                if (data.result === 'success') {
                    messageDiv.innerHTML = '<strong class="text-xl">Sucesso!</strong><br>Cadastro realizado no Projeto Novo Caminho.';
                    messageDiv.className = 'mt-6 text-center p-6 rounded-lg bg-green-100 text-green-800 border border-green-200';
                    form.reset();
                    currentStep = 0;
                    showStep(0);
                    preview.classList.add('hidden');
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                loader.classList.add('hidden');
                messageDiv.classList.remove('hidden');
                messageDiv.textContent = `Erro: ${error.message}`;
                messageDiv.className = 'mt-6 text-center p-4 rounded-lg bg-red-100 text-red-800';
                nextBtn.classList.remove('hidden');
            });
        };
    }
</script>
</body>
</html>
